<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Mein Bootstrap Blog</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
  <div class="container">
    <a class="navbar-brand" href="#">Mein Blog</a>
    <div id="navList" class="collapse navbar-collapse"></div>
  </div>
</nav>

<main class="container my-5">
  <div id="alertPlaceholder"></div>
  <div class="row">
    <aside class="col-lg-4 mb-4">
      <div class="card">
        <div class="card-body">
          <h5 class="card-title">Beiträge</h5>
          <ul id="postList" class="list-group list-group-flush"></ul>
        </div>
      </div>
    </aside>

    <section class="col-lg-8">
      <article id="content" class="card p-4">
        <h1 id="postTitle">Willkommen</h1>
        <div id="postMeta" class="text-muted mb-3"></div>
        <div id="postBody"></div>
      </article>
    </section>
  </div>
</main>

<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<script>
/*
Simple client-side Markdown blog:
- posts.json contains metadata and filename for each post
- posts/*.md are the markdown files
- hash routing: #/post/<slug>   (or empty for index)
*/

const POSTS_JSON = '/posts.json';

async function loadJSON(url){
  const res = await fetch(url);
  if(!res.ok) throw new Error('Fehler beim Laden: ' + url);
  return res.json();
}

function renderList(posts){
  const ul = document.getElementById('postList');
  ul.innerHTML = '';
  posts.forEach(p=>{
    const li = document.createElement('li');
    li.className = 'list-group-item';
    li.innerHTML = `<a href="#/post/${p.slug}" class="text-decoration-none">${p.title}</a>`;
    ul.appendChild(li);
  });
}

async function renderPost(posts, slug){
  const post = posts.find(p=>p.slug===slug) || posts[0];
  if(!post) {
    showAlert('Kein Beitrag gefunden', 'danger');
    return;
  }
  document.getElementById('postTitle').textContent = post.title;
  document.getElementById('postMeta').textContent = `Veröffentlicht: ${post.date || 'unbekannt'}`;
  try{
    const md = await (await fetch('/posts/' + post.file)).text();
    document.getElementById('postBody').innerHTML = marked.parse(md);
  } catch(err){
    showAlert('Fehler beim Laden des Beitrags: ' + err.message, 'danger');
    document.getElementById('postBody').innerHTML = '';
  }
}

function showAlert(text, type='info'){
  const el = document.getElementById('alertPlaceholder');
  el.innerHTML = `<div class="alert alert-${type}" role="alert">${text}</div>`;
  setTimeout(()=> el.innerHTML = '', 4000);
}

async function boot(){
  try{
    const posts = await loadJSON(POSTS_JSON);
    renderList(posts);
    const hash = location.hash;
    const match = hash.match(/^#\/post\/(.+)/);
    const slug = match ? match[1] : (posts[0] ? posts[0].slug : null);
    await renderPost(posts, slug);
    window.addEventListener('hashchange', async ()=> {
      const h = location.hash.match(/^#\/post\/(.+)/);
      await renderPost(posts, h ? h[1] : posts[0].slug);
    });
  }catch(e){
    showAlert(e.message, 'danger');
  }
}

boot();
</script>
</body>
</html>
